{% extends "marketdata/highchartsbase.html" %}
{% block title %}
<title>Option: {{ option.name }} </title>
{% endblock %}
{% block content %}  
function getDataOld(option_name) {
    var retvalue = {{ asks }};
    // ajax goes here
    return retvalue;
}
function getData(option_name) {
    var result = [];
    $.ajax({
        url: "/marketdata/option/refresh/{{option.name}}/",
        data: {option_name: "{{option.name}}"},
        type: 'POST',
        dataType: "json",
//        success: function(data) {
//            result = data.bids;
//        }
        success: function(data) {
					var series = chart.series[0],
						shift = series.data.length > 20; // shift if the series is longer than 20
		
					// add the point
					chart.series[0].addPoint(eval(point), true, shift);
					
					// call it again after one second
					setTimeout(getData, 1000);	
		},
		cache: false
    });
}

$(document).ready(function () {

    chart = new Highcharts.Chart({
            chart: {
				renderTo: 'marketdata',
                animation: Highcharts.svg, // don't animate in old IE
                marginRight: 10,
                events: {
						load: getData
					    }
//                events: {
//                        load: function() {
//                            // set up the updating of the chart each second
//                            var series = this.series[0];
//                            setInterval(function() {
//                                series.setData(getData(), true);
//                            }, 1000);
//                        }
//                    }
                },


            exporting: {
                buttons : {
                    contextButtons: {
                        enabled: false,
                        menuItems: null
                    }
                },
                enabled: false
            },
            title: {
                text: '{{ option.name }}',
                x: -20 //center
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                data: {{ strikes }}
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'Bids',
                data: {{ bids }}
            }, {
                name: 'Asks',
                data: {{asks}}
            }, {
                name: 'Fair Value',
                data: {{values}}
            }]
        });

    });
$(function () {
    chart = new Highcharts.Chart({
            chart: {
				renderTo: 'frozen-marketdata'
                   },
            exporting: {
                buttons : {
                    contextButtons: {
                        enabled: false,
                        menuItems: null
                    }
                },
                enabled: false
            },
            title: {
                text: '{{ option.name }}',
                x: -20 //center
            },
            subtitle: {
                text: '',
                x: -20
            },
            xAxis: {
                data: {{ strikes }}
            },
            yAxis: {
                title: {
                    text: ''
                },
                plotLines: [{
                    value: 0,
                    width: 1,
                    color: '#808080'
                }]
            },
            tooltip: {
                valueSuffix: ''
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle',
                borderWidth: 0
            },
            series: [{
                name: 'Bids',
                data: {{ bids }}
            }, {
                name: 'Asks',
                data: {{asks}}
            }, {
                name: 'Fair Value',
                data: {{values}}
            }]
        });
    });
   

		</script>
	</head>
	<body>
    <script src="{{STATIC_URL}}highcharts/js/highcharts.js"></script>
    <script src="{{STATIC_URL}}highcharts/js/modules/exporting.js"></script>

<!-- Fixed navbar -->
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/marketdata/">GW</a>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="/marketdata/">Futures</a></li>
        <li><a href="options.html">Options</a></li>
        <li><a href="published.html">Published Prices</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>

<script src="{{STATIC_URL}}highcharts/js/highcharts.js"></script>
<script src="{{STATIC_URL}}highcharts/js/modules/exporting.js"></script>

<div class="container theme-showcase">
    <div class="row">
        <div class="row"> 
            <div class="page-header">
                <h1>
                    Market Data
                </h1>
            </div>
        </div>
        <div class="row">    
            <div class="span4">
                <div id="marketdata" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
            </div>
        </div>    
    </div>
    <div class="row">
        <div class="row"> 
            <div class="page-header">
                <h1>
                    Frozen Market Data
                </h1>
            </div>
        </div>
        <div class="row">    
            <div class="span4">
                <div id="frozen-marketdata" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
            </div>
        </div>    
    </div>
</div>

	</body>
</html>



{% endblock %}

